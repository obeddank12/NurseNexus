<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hall of Fame | NurseNexus</title>
    <link rel="stylesheet" href="style.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCbMLvbP3h-iVKN2QvbZTnaRVT8eJX1nN8",
            authDomain: "nursenexus-b40c9.firebaseapp.com",
            projectId: "nursenexus-b40c9",
            storageBucket: "nursenexus-b40c9.firebasestorage.app",
            messagingSenderId: "884930628136",
            appId: "1:884930628136:web:e5ed1897b76d20a4bbc31d",
            measurementId: "G-Z6NJHJTMF5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>

    <style>
        .mega-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
            gap: 25px; 
            margin-top: 30px; 
        }
        .rank-card { 
            padding: 20px; 
            border-top: 5px solid var(--primary); 
            transition: transform 0.3s ease;
            height: fit-content;
        }
        .rank-card:hover { transform: translateY(-5px); }
        .rank-entry { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px 0; 
            border-bottom: 1px solid #f1f5f9; 
            font-size: 0.95rem; 
        }
        .rank-entry:last-child { border: none; }
        .top-3 { font-weight: bold; color: var(--primary); }
        .number { width: 30px; display: inline-block; color: #64748b; font-weight: bold; }
        header { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            text-align: center;
            padding: 60px 20px;
            border-radius: 0 0 20px 20px;
            margin-bottom: 40px;
        }
        .toggle-btn {
            width: 100%;
            margin-top: 15px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            color: var(--primary);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.85rem;
            transition: 0.3s;
        }
        .toggle-btn:hover { background: #f1f5f9; }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="logo"><a href="index.html" style="text-decoration: none; color: inherit;">NurseNexus</a></div>
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="quizzes.html">Quizzes</a></li>
        <li><a href="leaderboard.html" class="active">Hall of Fame</a></li>
        <li><a href="about.html">About</a></li>
        <li><button id="theme-toggle" style="background:none; border:none; cursor:pointer; font-size:1.2rem;">üåô</button></li>
    </ul>
</nav>

<header>
    <h1 style="font-size: 2.5rem; margin-bottom: 10px;">üèÜ Campus Hall of Fame</h1>
    <p>The Top 20 Elite Student Nurses Across All Categories</p>
</header>

<div class="container">
    <div id="mega-leaderboard-content" class="mega-grid"></div>
</div>

<script>
    async function loadMegaLeaderboard() {
        const container = document.getElementById('mega-leaderboard-content');
        const categories = ['Med-Surg', 'Obstetrics', 'Paediatrics', 'Public Health', 'Psychiatry', 'Ward-Management'];
        
        container.innerHTML = "<p style='text-align:center; grid-column: 1/-1;'>üîÑ Syncing clinical records with Cloud...</p>";

        let fullHTML = "";

        for (let cat of categories) {
            try {
                const snapshot = await db.collection("leaderboard")
                    .where("category", "==", cat)
                    .orderBy("percentage", "desc")
                    .limit(50) 
                    .get();

                let listHTML = "";
                let hasExtra = false;
                const catID = cat.replace(/\s+/g, '');

                if (snapshot.empty) {
                    listHTML = "<p style='color:#94a3b8; font-style:italic; padding: 10px;'>Waiting for the first ranked sessions...</p>";
                } else {
                    const uniqueLeaders = [];
                    const seenNurses = new Set();

                    snapshot.docs.forEach(doc => {
                        const data = doc.data();
                        if (!seenNurses.has(data.nurseID) && uniqueLeaders.length < 20) {
                            seenNurses.add(data.nurseID);
                            uniqueLeaders.push(data);
                        }
                    });

                    hasExtra = uniqueLeaders.length > 5;

                    uniqueLeaders.forEach((data, index) => {
                        const isTop3 = index < 3 ? 'top-3' : '';
                        const isHidden = index >= 5 ? `extra-${catID}` : '';
                        const style = index >= 5 ? 'display: none;' : '';
                        
                        let medal = `${index + 1}`;
                        if (index === 0) medal = "ü•á";
                        if (index === 1) medal = "ü•à";
                        if (index === 2) medal = "ü•â";
                        
                        listHTML += `
                            <div class="rank-entry ${isTop3} ${isHidden}" style="${style}">
                                <span><span class="number">${medal}</span> ${data.nurseName}</span>
                                <span style="font-weight:bold;">${data.percentage}%</span>
                            </div>`;
                    });
                }

                fullHTML += `
                    <div class="card rank-card">
                        <h3 style="color:var(--primary); margin-bottom:15px; border-bottom:2px solid #f1f5f9; padding-bottom:10px;">${cat}</h3>
                        <div id="container-${catID}">${listHTML}</div>
                        ${hasExtra ? `<button class="toggle-btn" onclick="toggleRows('${catID}', this)">Show Full Top 20</button>` : ''}
                    </div>`;
            } catch (error) {
                console.error("Error fetching Top 20 for " + cat + ":", error);
            }
        }
        container.innerHTML = fullHTML;
    }

    function toggleRows(catID, btn) {
        const extraRows = document.querySelectorAll(`.extra-${catID}`);
        const isCollapsed = btn.innerText.includes("Show Full");

        extraRows.forEach(row => {
            row.style.display = isCollapsed ? 'flex' : 'none';
        });

        btn.innerText = isCollapsed ? "Show Less" : "Show Full Top 20";
        
        if (!isCollapsed) {
            btn.parentElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }

    document.addEventListener('DOMContentLoaded', loadMegaLeaderboard);
</script>

<script src="script.js"></script>
</body>
</html>